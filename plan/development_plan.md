# HMB (Html Module Builder) 開発計画

このドキュメントは、README.mdに記載された仕様に基づき、HMBの開発工程を詳細化したものです。

## Phase 0: プロジェクトセットアップ (準備)

開発を開始するための環境とテスト用データの準備を行います。

### 0-1. リポジトリ構成 (開発環境)
ツール自体のソースコードと、動作確認用のサンプルプロジェクトを明確に分離します。

```
HMB/
├── bin/                # CLI実行ファイル
│   └── hmb.js
├── src/                # ツールのソースコード
│   ├── index.js        # メインロジック
│   ├── builder.js      # ビルド処理
│   └── ...
├── example/            # 動作確認用サンプルプロジェクト (READMEの構成をここに再現)
│   ├── pages/          # テスト用ページ
│   ├── modules/        # テスト用モジュール
│   └── dist/           # ビルド出力先 (git ignore対象)
├── package.json
└── README.md
```

### 0-2. 初期化タスク
- [x] **プロジェクト初期化**: `npm init` (package.json作成)、必要なパッケージの選定とインストール (`npm install` が機能する状態にする)
- [x] **ディレクトリ構造の作成**: 上記のリポジトリ構成を作成
- [x] **テストデータの作成 (exampleフォルダ内)**:
    - `example/pages/index.html` (各種記法を含むもの)
    - `example/modules/header.html`, `example/modules/footer.html`
    - `example/modules/components/card.html`
    - `example/modules/var/site.yaml`

## Phase 1: 基本機能実装 (v0.1.0)

コアとなるビルド機能を実装します。

### ステップ 1: CLIと基本的なファイル操作
- [x] **CLIエントリーポイント**: `package.json` への `bin` 設定追加 (`hmb` コマンドとして実行可能にする)
- [x] **ファイルコピー処理**: `pages/` から `dist/` へ、HTML以外の静的リソースをコピーする機能または全コピー機能

### ステップ 2: 変数管理システム
- [x] **YAMLローダー**: `modules/var/` 内のYAMLファイルを解析し、グローバル変数オブジェクト (`variables`) を構築する機能
- [x] **グローバル変数置換**: HTML内の `{{@namespace.property}}` を実際の値に置換する処理

### ステップ 3: モジュールシステム (核心部)
- [x] **モジュール解決**: `<module src="...">` タグのパースと、対応するファイルパスの特定 (`modules/` 起点)
- [x] **モジュール読み込み**: 対象HTMLファイルの読み込み
- [x] **引数置換**: `<module>` タグの属性を読み取り、モジュール内の `{{arg}}` を置換
- [x] **再帰処理**: モジュール内にさらにモジュールがある場合の処理 (必要に応じて)

### ステップ 4: 統合と出力
- [x] **HTML出力**: 処理済みのHTMLを `dist/` に書き出し
- [x] **統合テスト**: サンプルプロジェクトを用いたビルド実行確認

## Phase 2: 開発体験向上 (v0.2.0)

開発者が快適に利用できるための機能を追加します。

- [x] **開発サーバー**: 静的ファイル配信サーバーの実装 (`http` モジュール等)
- [x] **ファイル監視 (Watch)**: `chokidar` 等を使用し、ファイル変更を検知して自動リビルド
- [x] **エラーハンドリング強化**: 存在しない変数やモジュール参照時のわかりやすいエラー表示

## Phase 3: 拡張機能 (v0.3.0)

より高度なユースケースに対応します。

- [x] **条件付きレンダリング**: `<!-- @if ... -->` の実装
- [x] **動的変数**: ビルド日時などの自動挿入
- [x] **アセット最適化**: オプションでの圧縮処理など (Optional) --minify option added


## 技術スタック (想定)

- 言語: JavaScript (Node.js)
- 依存ライブラリ (最小限):
    - `fs-extra`: ファイル操作用
    - `js-yaml`: YAMLパース用
    - `chokidar`: ファイル監視用 (Phase 2)
    - `commander` or `yargs`: CLI引数処理用
